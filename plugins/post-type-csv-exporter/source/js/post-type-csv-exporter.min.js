!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){o(1),e.exports=o(3)},function(e,t,o){"use strict";(function(e){var t,o,n={error:"background: #242424; color: red",warning:"background: #242424; color: yellow;",info:"background: #242424; color: cyan;",pass:"background: #242424; color: green;",debug:"background: #242424; color: orchid;",event:"background: #242424; color: magenta;"};function s(e){var t=window.location.href,o=!1;return-1===t.indexOf("?log=".concat(e))&&-1===t.indexOf("&log=".concat(e))&&-1===t.indexOf("?log[]=".concat(e))&&-1===t.indexOf("&log[]=".concat(e))||(o=!0),o}function i(e){void 0!==e.message?(void 0!==e.details&&console.group(),"string"==typeof e.message||e.message instanceof String?console.log("%c".concat(e.message),n[e.type]):console.log(e.message),void 0!==e.details&&(console.log(e.details),console.groupEnd())):(console.group(),console.log("%cIssue with use of log(), please ensure a object is passed to log(). in form of:",n.error),console.log({type:"String either error, warning, info or pass",message:"Message to be highlighted for details.",details:"Mixed/Not Required"}),console.groupEnd())}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(s("info")||s("pass")||s("debug")||s("event")||s("all"))&&"undefined"!=typeof console&&void 0!==console.log&&void 0!==e.type&&(s(e.type)||s("all"))&&void 0!==e.type&&"error"!==e.type&&"warning"!==e.type&&i(e),void 0===e.type||"error"!==e.type&&"warning"!==e.type||i(e)}o={_form:void 0,_submitButton:void 0,_defaultButtonMessage:void 0,_submitButtonMessage:void 0,_pageMessageContainer:void 0,_isCompiling:!1,_csvData:[],init:function(e,o){this._form=t(e),this.form().length?(this._submitButton=this.form().find('button[type="submit"]'),this._defaultButtonMessage=this.submitButton().html(),this.setPageMessageContainer(t(o)),this.setPageMessageContainer(t(o)),t.fn.datepicker&&this.form().find(".csv-export-date-picker").datepicker({dateFormat:"yy-mm-dd"}),this.onSubmit()):r({type:"error",message:"CSV Export form is not on this page, form missing or this script should not be enqueued."})},onSubmit:function(){var e=this;this.form().submit((function(t){t.preventDefault(),e.isCompiling()||(e.setIsCompiling(!0),e.requestCSVExport())}))},formToJSON:function(e){return[].reduce.call(e,(function(e,t){return e[t.name]=t.value,e}))},requestCSVExport:function(){var e=new FormData(this.form()[0]),o=this,n={action:postTypeCSVExporterConfig.action,wp_nonce:postTypeCSVExporterConfig.ajax_nonce,post_type:postTypeCSVExporterConfig.post_type};e.forEach((function(e,t){n[t]=e})),o.emptyCsvData(),o.setSubmitButtonMessage("Exporting..."),o.updateSubmitButton(),t.post(ajaxurl,n,(function(e){if(e.success){for(var t in o.addCsvData(e.data.headers),e.data.rows)o.addCsvData(e.data.rows[t]);o.exportToCsv(e.data.filename,o.csvData()),o.setIsCompiling(!1),o.updateSubmitButton(),o.updatePageMessage("Successful Export","success"),r({type:"info",message:"Successfully generated export."})}else o.setIsCompiling(!1),o.updateSubmitButton(),void 0!==e.message?o.updatePageMessage(e.message,"error"):o.updatePageMessage("An unexpected error has occurred, please try again.","error"),r({type:"error",message:"Error generate export failed, unsuccessful.",details:{response:e}})})).fail((function(e,t,s){o.setIsCompiling(!1),o.updateSubmitButton(),o.updatePageMessage("An unexpected error has occurred, please try again.","error"),r({type:"error",message:"Error generate export failed, failed connection.",details:{error:s,data:n}})}))},updateSubmitButton:function(){this.isCompiling()?(this.submitButton().html(this.submitButtonMessage()),this.submitButton().prop("disabled",!0)):(this.submitButton().html(this.defaultButtonMessage()),this.submitButton().prop("disabled",!1))},updatePageMessage:function(e,t){this.pageMessageContainer().length&&(this.pageMessageContainer().html(this.pageMessageHtml(e,t)),this.makeNoticesDismissible())},pageMessageHtml:function(e,t){return'<div id="message" class="'+("error"===t?"error notice notice-error is-dismissible":"updated notice notice-success is-dismissible")+'"><p>'+e+"</p></div>"},makeNoticesDismissible:function(){t(".notice.is-dismissible").each((function(){var e=t(this),o=t('<button type="button" class="notice-dismiss"><span class="screen-reader-text"></span></button>');o.find(".screen-reader-text").text("Dismiss"),o.on("click.wp-dismiss-notice",(function(t){t.preventDefault(),e.fadeTo(100,0,(function(){e.slideUp(100,(function(){e.remove()}))}))})),e.append(o)}))},addCsvData:function(e){this.csvData().push(e)},emptyCsvData:function(){this._csvData=[]},exportToCsv:function(e,t){for(var o=function(e){for(var t="",o=0;o<e.length;o++){var n=null===e[o]?"":e[o].toString();e[o]instanceof Date&&(n=e[o].toLocaleString());var s=n.replace(/"/g,'""');s.search(/("|,|\n)/g)>=0&&(s='"'+s+'"'),o>0&&(t+=","),t+=s}return t+"\n"},n="",s=0;s<t.length;s++)n+=o(t[s]);var i=new Blob([n],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,e);else{var r=document.createElement("a");if(void 0!==r.download){var a=URL.createObjectURL(i);r.setAttribute("href",a),r.setAttribute("download",e),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}},setIsCompiling:function(e){this._isCompiling=e},setSubmitButtonMessage:function(e){this._submitButtonMessage=e},setPageMessageContainer:function(e){this._pageMessageContainer=e},form:function(){return this._form},submitButton:function(){return this._submitButton},submitButtonMessage:function(){return this._submitButtonMessage},defaultButtonMessage:function(){return this._defaultButtonMessage},pageMessageContainer:function(){return this._pageMessageContainer},isCompiling:function(){return this._isCompiling},csvData:function(){return this._csvData}},(t=e)(document).ready((function(){window.postTypeCSVExporter=o,o.init("#post-type-csv-exporter-form","#page-message")}))}).call(this,o(2))},function(e,t){e.exports=jQuery},function(e,t,o){}]);
//# sourceMappingURL=post-type-csv-exporter.min.js.map